<link href="css/jquery-ui.min.css" rel="stylesheet" type="text/css">
<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/jquery-ui.min.js" type="text/javascript"></script>
<script src="js/underscore.min.js" type="text/javascript"></script>

<div class="container">
  <h2>Volume Test</h2>
  <div id="zones" class="row"></div>
  
  <script type="text/javascript">
    $(function(){
      //Empty current zones div
      $('#zones').html('');
      
      //Retrieve connected audio zones
      $.get('http://127.0.0.1:8000/api/audio', function(data){
        console.log(data);
        data.zones.forEach(function(z){
          //Parse template for zone and append in view
          $('#zones').append(_.template($('#zone-volume-tmpl').html(), z));
          
          //Activate zone's volume slider
          $('#slider-'+z.zone).slider({ value:z.volume, min:0, max:100, step:1, orientation:'vertical',
            change:function(evt, ui){
              var volume = ui.value;
              if(isNaN(volume)) return;
                            
              //Update view with value
              $('#value'+z.zone).html(volume);
                            
              //Perform action with API
              $.ajax({
                url:'http://localhost:8000/api/audio/'+z.zone,
                type:'post',
                dataType:'json',
                data:{ volume:volume }
              });
            },
            
            slide:function(evt, ui){
              $('#volume-'+z.zone).html(ui.value);
            }
          });
        });
        //end get
      });
    });
  </script>
  
  <script type="text/template" id="zone-volume-tmpl">
    <div class="span3">
      <h5><%= name %></h5>
      <div id="slider-<%= zone %>"></div>
      <br>
      <b id="volume-<%= zone %>"><%= volume %></b>
    </div>
  </script>
</div>